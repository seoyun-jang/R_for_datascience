---
title: "1.7 통계적 변환"
author: "seo yun Jang"
date: '2022 2 4 '
output: html_document
---
## 1.7 통계적 변환
막대그래프는 간단할 것 같지만 플롯에 대해 미묘한 것을 드러내기 때문에 흥미로운 차트이다. 막대그래프는 `geom_bar()`로 그릴 수 있다. 다음은 diamond 데이터셋에서 cut으로 그룹한 다이아몬드의 총 개수를 나타낸다.  
* diamonds 데이터 셋은 54000여개의 다이몬드를 대상으로 크기(carat), 컷팅레벨(cut), 색(color), 투명도(clarity) 등이 조사되어 있다.  

```{r}
ggplot(data = diamonds) +
  geom_bar(mapping = aes(x = cut))
```
  
위의 코드에서도 알 수 있듯이 y축에 count는 diamonds의 변수가 아니다. count는 산점도와 같은 다수의 그래프는 데이터셋의 원 값을 플롯을 그린다. 막대그래프와 같은 다른 그래프는 플롯으로 그릴 새로운 값을 계산한다.

* 막대그래프, 히스토그램, 빈도 다각형은 데이터를 빈(bin)계급으로 만든 후, 각 빈에 떨어지는 점들의 개수인 도수를 플롯한다.
* 평활 차트들은 데이터에 모델을 적합한 후 모델을 이용한 예측값을 플롯한다.
* 박스플롯은 분포의 robust한 요약값을 계산한 후 특수한 형태의 박스로 표시한다.
  
`stat`인수의 기본값을 조사하면 한 지옴이 어떤 스탯을 사용하는지 알 수 있다.  
예를 들어 `?geom_bar`를 하면 `stat`이 "count"임을 보여준다. 이는 `geom_bar()`가 `stat_count()`를 사용한다는 의미이다.  
또한 지옴과 스탯을 서로 바꿔서 사용할 수 있다. 예를 들어 이전 플롯을 `geom_bar()`
대신 `stat_count()`를 사용하여 생성할 수 있다. 모든 지옴은 기본 스탯이 있고, 모든 스탯은 기본 지옴이 있기때문에 가능하다.

```{r}
ggplot(data = diamonds) +
  stat_count(mapping = aes(x = cut))
```

### 명시적으로 스탯을 사용하는 이유
* 기본 스탯을 덮어쓰고 싶을 수 있다  
다음의 코드에서 `geom_bar()`의 스탯을 'count'에서 'identity'로 변경했다. 이렇게 하면 막대의 높이를 y변수의 원 값으로 매핑할 수 있다.

```{r}
demo <- tribble(
  ~cut,        ~freq,
  "Fair",       1610,
  "Good",       4906,
  "Very Good",  12082,
  "Premium",    13791,
  "Ideal",      21551
)
ggplot(data = demo) +
  geom_bar(mapping = aes(x = cut, y = freq), stat = "identity")
```
  
막대그래프에서 막대의 높이가 데이터에서 존재하느 그래프를 의미하기도 하고, 또는 행을 세서 생성되는, 앞서 본 막대 그래프를 의미하기도 한다.  
* 변환된 변수에서 심미성으로 기본 매핑을 덮어쓰고자 할 수 있다.

## 연습문제
1. `stat_summary()`와 연관된 기본 지옴은 무엇인가? 스탯 함수 대신 이 지옴함수를 사용하여 어떻게 이전 플롯을 다시 생성하겠는가?

```{r}
ggplot(data = diamonds)+ 
  geom_pointrange(
    mapping = aes(x = cut, y = depth),
    fun.min = min,
    fun.max = max,
    fun = median,
    stat = "summary")
```

2. `geom_col()`의 역할은 무엇인가? `geom_bar()`와 어떻게 다른가?
```{r}
ggplot(data = diamonds)+
  geom_bar(mapping = aes(x = cut))
```
```{r}
ggplot(data = diamonds)+
  geom_col(mapping = aes(x = cut, y = depth))
```


3. 대부분의 지옴과 스탯을 쌍을 이루어 거의 항상 함께 사용된다. 도움말을 읽고 모든 쌍의 목록을 만들어라. 공통점은 무엇인가?


4. `stat_smooth()`는 어떤 변수를 계산하는가? 이 동작을 제어하는 파라미터들은 무엇인가?

```{r}
ggplot(data = diamonds)+
  geom_smooth(mapping = aes(x = price, y = depth))
```

```{r}
ggplot(data = diamonds)+
  stat_smooth(mapping = aes(x = price, y = depth))
```


5. 우리의 비율 막대 그래프에서 group = 1이라고 설정했어야 했다. 왜 그런가? (다음 두 그래프의 문제는 무엇인가?)

```{r}
ggplot(data = diamonds) +
  geom_bar(mapping = aes(x = cut, y = ..prop.., group = 1))
```

```{r}
ggplot(data = diamonds) +
  geom_bar(mapping = aes(x = cut, y = ..count.. / sum(..count..), fill = color,group = color))
```
