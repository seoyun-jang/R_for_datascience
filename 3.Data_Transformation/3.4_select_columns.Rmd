---
title: "3.4 Select columns"
author: "seo yun Jang"
date: '2022 2 9 '
output: html_document
---
```{r, warning=FALSE}
library(tidyr)
library(tidyverse)
library(dplyr)
library(ggplot2)

flights <- nycflights13::flights
```

## 3.4 select()로 열 선택하기

변수가 수백, 수천 개인 데이터셋에서 실제로 관심있는 변수들로 좁힐 때, select()와 변수 이름에 기반한 연산들을 이용하면 유용한 서브셋으로 신속하게 줌인해 볼 수 있다.

```{r}
# 이름으로 열 선택
select(flights, year, month, day)

# year와 day 사이의 열 모두 선택
select(flights, year:day)

# yeaer에서 day까지의 열들을 제외한 열 모두 선택(경계 포함)
select(flights, -(year:day))
```
#### select()안에서 사용할 수 있는 도우미 함수들
- `starts_with(abc)` : 'abc'로 시작하는 이름에 매칭  
- `ends_with(xzy)` : 'xyz'으로 끝나는 이름에 매칭  
- `contains(ijk)` : 'ijk'를 포함하는 이름에 매칭  
- `matches("(.)\\1")` : 정규표현식에 매칭되는 변수들을 선택. 이 표현식은 반복되는 문자를 포함하는 변수에 매칭된다  
- `num_range("x", 1:3)` : x1, x2, x3에 매칭  

#### rename()
변수명 변경에 `select()`를 이용할 수 있지만, 명시적으로 언급하지 않은 모든 변수를 누락하기 때문에 유용하지 않다. 대신 `rename()`을 사용하면 명시적으로 언급하지 않은 모든 변수를 모두 유지한다.
```{r}
# rename(data, 변경 후 변수명 = 변경 전 변수명 )
re_flights <- rename(flights, tail_num = tailnum)
head(re_flights)
```

#### everything()  
몇개의 변수를 데이터프레임의 시작 부분으로 옮기고 싶을 때 유용하다.
```{r}
select(flights, time_hour, air_time, everything())
```

### 3.4.1 연습문제
1. flights에서 dep_time, dep_delay, arr_time, arr_delay를 선택할 수 있는 가능한 모든 방법에 대해 브레인스토밍하라
```{r}
# 1. 변수의 이름 지정(인용 부호X)
select(flights, dep_time, dep_delay, arr_time, arr_delay)

# 2.변수의 이름 지정(인용 부호O)
select(flights, "dep_time", "dep_delay", "arr_time", "arr_delay")

# 3. 변수의 열 번호 지정
select(flights, 4,6,7,9)

# 4. start_with()
select(flights, starts_with("dep"), starts_with("arr"))

# 5.변수로 저장 후 지정 
variable <- c("dep_time", "dep_delay", "arr_time", "arr_delay")
select(flights, variable)

# 6. 5번과 all_of / any_of를 함께 사용하여 지정
select(flights, all_of(variable))
select(flights, any_of(variable))

# 7. 정규식을 이용하여 지정
select(flights, matches("^(dep|arr)_(time|delay)$"))

```
> all_of : 주어진 범위에서 모든 원소들이 조건을 만족하면 true, 그렇지 않으면 false를 반환한다.   
any_of : 주어진 범위에서 한개 이상의 원소들이 조건을 만족하면 true, 그렇지 않으면 false를 반환한다.

2. select() 호출에서 한 변수의 이름을 여러 번 포함하면 어떻게 되는가?

```{r}
select(flights, year, year)
```
- 한 변수의 이름을 여러 번 포함해도 중복해서 출력하지 않는다.
- 중복된 변수는 처음 나타나는 위치에서 한번만 출력한다.

3. one_of()함수는 어떤 일을 하는가? 다음 벡터와 함께 사용하면 도움이 되는 이유는 무엇인가?

```
vars <- c("year", "month", "day", "dep_delay", "arr_delay")
```
```{r}
vars <- c("year", "month", "day", "dep_delay", "arr_delay")
select(flights, one_of(vars))
```



4. 다음 코드의 실행결과는 예상과 같은가?
```{r}
select(flights, contains("TIME"))
```
- `contains()`의 기본값이 대소문자를 무시하는 것 이므로, 대소문자를 구분하고자 하는 경우 `ignore.caes = FALSE`인수를 추가한다.
```{r}
select(flights, contains("TIME", ignore.case = FALSE))
```

